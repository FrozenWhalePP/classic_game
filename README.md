1 引言
======

棋类运动是世界性的运动，兼具趣味性和竞技性。飞行棋、跳跳棋等更偏向于趣味，围棋、象棋等则更注重技术。在众多棋类之间，五子棋较为简单，在大众中得到了广泛普及，不论是老人还是儿童，都能够同开一局有趣的五子棋游戏。

本项目使用Java实现了简单版的五子棋游戏，不涉及网络和多线程，即实现了单机版的五子棋游戏。五子棋的游戏模式也较为简单，逻辑并不复杂，但作为一个综合设计，涉及的技术较为全面；这也对代码的可读性和可维护性提出了更高的要求。

本游戏提供了良好的界面，布局优雅，给予必要的提示。

2 设计依据及框图
================

2.1 设计思想
------------

本项目为Java GUI应用，使用Java
swing开发图形界面，对布局和样式有较多的设计。良好的实现了Java的面向对象的设计思想，对类进行了合理的封装、继承。同时封装了颜色等样式，利用枚举类封装类型，使得代码的可读写和可维护性更高。

设计时，做到解耦，各个模块能够独立实现属于自己的功能，同时又能够有机的进行组合，从而实现完整的功能。注重函数的抽象封装，以尽可能的提高代码复用。



## 2.2 构成

![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif)

3 各模块功能实现
================

3.1 棋盘布局
------------

棋盘由ChessBoard类实现。棋盘固定了W和H表示宽和高，这里的宽和高指棋盘的列数和行数，固定W=H=16。给定SPAN表示每个格子的宽度，至此，可以将画板进行分割成16\*16的格阵，每一个单元格有其位置索引。	这将元素的位置控制变得简单，只需要关注SPAN和W、H的大小，即可控制棋盘的大小，而无需关注每一个元素的位置。

绘制棋盘，调用Graphics的drawLine方法，依次绘制横向、纵向的直线，形成网格。需要调用repaint()方法来实现重绘，因此需要重写paintComponent方法。

棋盘上固定了一系列的单元格（Point类），每个单元格构造时传入参数即位置索引。在Point内部，实现了draw方法用以绘制棋盘的棋子。

```Java
graphics2D.fillOval(abx, aby, d-1, d-1);
```

其中涉及到abx、aby的计算如下：

```Java
abx = x * d - d / 2;
aby = y * d - d / 2;
ox = x * d;
oy = y * d;
```

这表示d是单元格宽度，x是位置索引，x\*d是绝对位置，由于Graphics2d绘制时候以左上角为起点，绘制一个矩形，宽和高都是d，因此需要进行位置偏移，至圆心。其中宽度和高度设置为d-1表示留有一定的间距。

3.3 游戏进程
------------

![](https://frozenwhale.oss-cn-beijing.aliyuncs.com/img/20200531210536.png)

游戏通过鼠标点击棋盘的位置进行。通过添加鼠标监听事件，可以得到点击处的绝对坐标xy。遍历整个棋盘的所有格子，判断点x和y是否在某个格子的范围内，在范围内和返回这个格子，即落点。若无返回，则表示点击区域无效。

得到点之后，判断当前是黑棋还是白棋回合，将该位置绘制成对应的颜色，并设置格子的类型为对应，后玩家不能够重复落子。

   

```Java
int x = e.getX();

int y = e.getY();

Point p = getClickPoint(x, y);

if(p == null) return;

if(currentGo == PointType.BLACK){

    blackPoints.add(p);

    p.setType(PointType.BLACK);

    p.setColor(ChessColor.BLACK);

}else{

    whitePoints.add(p);

    p.setType(PointType.WHITE);

    p.setColor(ChessColor.WHITE);

}
```

每次有效点击后，首先判断是否胜利。抽象为win()方法，判断逻辑分为四大部分。根据回合，得到属于其的棋子容器。遍历容器的每一个棋子，由于五子棋的规则是达到5个连续排列的棋子即胜利，因此遍历需要遍历长度至多为9的单元格（考虑边界）。以x为起点，上下（左右、左上左下、右上右下）各4个单元，依次判断，如果连续5个单元格是属于该回合的棋子，则表示胜利，一旦中断，计数器清零。经过所有逻辑判断未胜利，即返回false表示游戏继续进行。

除了判断胜利，还需要每次判断是否棋盘已满。这可以通过黑棋和白棋数目之和是否大约等于所有格子的和来进行判断。

3.4 样式设置
------------

样式的设置分为主要界面布局和颜色等设置。

主要窗口App继承自JFrame，使用BorderLayout布局，North是JtoolBar，含有Jlabel，South是JtoolBar，含有Jbutton，Center是Jpanel。

所有的组件和容器使用无边框样式，字体使用Arial Unicode
MS，对于JoptionPane则通过UIManager来进行设置。

在JtoolBar中对称的添加了JSeparsator作为分隔。

对于颜色的设置，封装为颜色类。

在游戏过程中，回合的切换以文本text、背景色和字体色进行提示。

4 软件调试分析
==============

4.1 测试过程
------------

![](https://frozenwhale.oss-cn-beijing.aliyuncs.com/img/20200531210731.png)